{'PATH_MOD': '/content/drive/MyDrive/DiffSTG/output/model/', 'PATH_LOG': '/content/drive/MyDrive/DiffSTG/output/log/', 'PATH_FORECAST': '/content/drive/MyDrive/DiffSTG/output/forecast/', 'data': {'name': 'PM', 'path': '/content/drive/MyDrive/DiffSTG/data/dataset/', 'feature_file': '/content/drive/MyDrive/DiffSTG/data/dataset/PM/flow.npy', 'spatial': '/content/drive/MyDrive/DiffSTG/data/dataset/PM/adj.npy', 'num_recent': 1, 'num_features': 1, 'num_vertices': 22, 'points_per_hour': 1, 'val_start_idx': 837, 'test_start_idx': 1116}, 'gpu_id': None, 'model': {'T_p': 96, 'T_h': 96, 'V': 22, 'F': 1, 'week_len': 7, 'day_len': 24, 'device': device(type='cuda'), 'd_h': 32, 'N': 200, 'sample_steps': 200, 'epsilon_theta': 'UGnet', 'is_label_condition': True, 'beta_end': 0.1, 'beta_schedule': 'quad', 'sample_strategy': 'ddpm', 'channel_multipliers': [1, 2], 'supports_len': 2, 'C': 32, 'n_channels': 32}, 'n_samples': 8, 'model_name': 'DiffSTG', 'is_test': False, 'epoch': 300, 'optimizer': 'adam', 'lr': 0.002, 'batch_size': 16, 'wd': 1e-05, 'early_stop': 10, 'start_epoch': 0, 'device': device(type='cuda'), 'logger': <utils.common_utils.Logger object at 0x7a2db3c11640>, 'nni': False, 'mask_ratio': 0.0, 'T_h': 96, 'T_p': 96, 'trial_name': 'UGnet+32+200+quad+0.1+200+ddpm+96+8+True+PM+0.0+False+False+0.002+16', 'log_path': '/content/drive/MyDrive/DiffSTG/output/log//UGnet+32+200+quad+0.1+200+ddpm+96+8+True+PM+0.0+False+False+0.002+16.log'}
model path:/content/drive/MyDrive/DiffSTG/output/model/UGnet+32+200+quad+0.1+200+ddpm+96+8+True+PM+0.0+False+False+0.002+16N-200+T_h-96+T_p-96+epsilon_theta-UGnet.dm4stg
forecast_path:/content/drive/MyDrive/DiffSTG/output/model/UGnet+32+200+quad+0.1+200+ddpm+96+8+True+PM+0.0+False+False+0.002+16N-200+T_h-96+T_p-96+epsilon_theta-UGnet.dm4stg
DiffSTG(
  (eps_model): UGnet(
    (down): ModuleList(
      (0-1): 2 x DownBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Identity()
          (t_conv): Conv2d(32, 32, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 32), eps=1e-05, elementwise_affine=True)
        )
      )
      (2): Downsample(
        (conv): Conv2d(32, 32, kernel_size=(1, 3), stride=(1, 2), padding=(0, 1))
      )
      (3): DownBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(32, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(32, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
            (shortcut): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
          (t_conv): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 64), eps=1e-05, elementwise_affine=True)
        )
      )
      (4): DownBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Identity()
          (t_conv): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 64), eps=1e-05, elementwise_affine=True)
        )
      )
    )
    (middle): MiddleBlock(
      (res1): ResidualBlock(
        (tcn1): TcnBlock(
          (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
          (chomp): Chomp()
          (drop): Dropout(p=0.0, inplace=False)
          (net): Sequential(
            (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (1): Chomp()
            (2): Dropout(p=0.0, inplace=False)
          )
        )
        (tcn2): TcnBlock(
          (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
          (chomp): Chomp()
          (drop): Dropout(p=0.0, inplace=False)
          (net): Sequential(
            (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (1): Chomp()
            (2): Dropout(p=0.0, inplace=False)
          )
        )
        (shortcut): Identity()
        (t_conv): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
        (spatial): SpatialBlock()
        (norm): LayerNorm((22, 64), eps=1e-05, elementwise_affine=True)
      )
      (res2): ResidualBlock(
        (tcn1): TcnBlock(
          (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
          (chomp): Chomp()
          (drop): Dropout(p=0.0, inplace=False)
          (net): Sequential(
            (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (1): Chomp()
            (2): Dropout(p=0.0, inplace=False)
          )
        )
        (tcn2): TcnBlock(
          (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
          (chomp): Chomp()
          (drop): Dropout(p=0.0, inplace=False)
          (net): Sequential(
            (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (1): Chomp()
            (2): Dropout(p=0.0, inplace=False)
          )
        )
        (shortcut): Identity()
        (t_conv): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
        (spatial): SpatialBlock()
        (norm): LayerNorm((22, 64), eps=1e-05, elementwise_affine=True)
      )
    )
    (up): ModuleList(
      (0-1): 2 x UpBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(128, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(128, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
            (shortcut): Conv2d(128, 64, kernel_size=(1, 1), stride=(1, 1))
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Conv2d(128, 64, kernel_size=(1, 1), stride=(1, 1))
          (t_conv): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 64), eps=1e-05, elementwise_affine=True)
        )
      )
      (2): UpBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(96, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(96, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
            (shortcut): Conv2d(96, 32, kernel_size=(1, 1), stride=(1, 1))
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Conv2d(96, 32, kernel_size=(1, 1), stride=(1, 1))
          (t_conv): Conv2d(32, 32, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 32), eps=1e-05, elementwise_affine=True)
        )
      )
      (3): Upsample(
        (conv): ConvTranspose2d(32, 32, kernel_size=(1, 4), stride=(1, 2), padding=(0, 1))
      )
      (4-6): 3 x UpBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(64, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(64, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
            (shortcut): Conv2d(64, 32, kernel_size=(1, 1), stride=(1, 1))
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Conv2d(64, 32, kernel_size=(1, 1), stride=(1, 1))
          (t_conv): Conv2d(32, 32, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 32), eps=1e-05, elementwise_affine=True)
        )
      )
    )
    (x_proj): Conv2d(1, 32, kernel_size=(1, 1), stride=(1, 1))
    (out): Sequential(
      (0): Conv2d(32, 1, kernel_size=(1, 1), stride=(1, 1))
      (1): Linear(in_features=384, out_features=192, bias=True)
    )
  )
)Num_of_parameters:899041
      |---Train--- |---Val Future-- -|-----Val History----|
Epoch | Loss  Time | MAE     RMSE    |  MAE    RMSE   Time|
   1.0| 10.289 12.3s |[407.44 637.65 ] | 409.91 642.82 100.57s
   2.0| 9.977 11.1s | 435.89 688.92  | 438.47 695.20 104.52s
   3.0| 9.317 11.2s | 583.30 960.59  | 605.88 1000.27105.40s
   4.0| 5.259 11.2s |[150.10 203.94 ] | 158.11 218.12 105.31s
   5.0| 2.571 11.2s |[48.42  63.50  ] | 50.18  66.55  105.43s
   6.0| 1.705 11.3s | 53.21  71.16   | 49.97  68.51  105.44s
   7.0| 1.426 11.3s |[20.43  28.04  ] | 16.05  22.94  105.49s
   8.0| 1.268 11.3s |[16.23  22.58  ] | 10.03  14.77  105.11s
   9.0| 1.155 11.3s |[12.94  19.89  ] | 7.51   11.71  104.95s
  10.0| 1.125 11.3s |[10.96  15.56  ] | 6.80   10.06  105.30s
  11.0| 1.082 11.3s | 13.64  18.95   | 9.15   13.13  105.21s
  12.0| 1.014 11.2s | 11.70  15.90   | 7.47   10.67  104.99s
  13.0| 0.978 11.1s | 16.12  20.99   | 11.65  15.44  105.43s
  14.0| 0.946 11.2s |[9.35   13.37  ] | 6.88   9.93   104.76s
  15.0| 0.912 11.3s | 10.49  15.21   | 8.60   12.01  105.17s
  16.0| 0.878 11.3s |[9.14   13.20  ] | 6.86   10.29  104.77s
  17.0| 0.863 11.2s |[8.41   12.05  ] | 6.52   9.57   105.07s
  18.0| 0.842 11.2s |[7.87   11.25  ] | 6.86   10.17  105.21s
  19.0| 0.814 11.2s | 8.84   12.23   | 7.20   10.13  105.19s
  20.0| 0.821 11.2s | 9.97   14.78   | 6.53   9.74   104.62s
  21.0| 0.808 11.3s | 8.35   11.81   | 5.45   8.09   105.42s
  22.0| 0.763 11.3s | 10.54  14.76   | 5.73   8.61   105.23s
  23.0| 0.740 11.3s | 9.80   13.42   | 9.18   12.66  105.49s
  24.0| 0.738 11.3s | 9.50   13.40   | 6.76   10.18  105.39s
  25.0| 0.646 11.3s | 10.49  14.45   | 7.45   10.47  104.96s
  26.0| 0.605 11.3s | 9.78   13.68   | 6.54   9.60   105.17s
  27.0| 0.582 11.3s | 9.17   12.94   | 6.28   9.41   104.82s
  28.0| 0.562 11.2s | 9.39   13.08   | 6.41   9.49   105.34s
  29.0| 0.557 11.3s | 12.26  16.40   | 7.89   11.10  105.27s
predict_path = '/content/drive/MyDrive/DiffSTG/output/forecast/UGnet+32+200+quad+0.1+200+ddpm+96+8+True+PM+0.0+False+False+0.002+16.pkl'
 |[12.20  15.45  ] | 5.41   7.79   179.88s
sample_strategy:ddim_multi, sample_steps:40 Final results in test:12.20  15.45  14.68  0.11    225.42  | 29   
