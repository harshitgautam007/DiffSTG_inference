{'PATH_MOD': '/content/drive/MyDrive/DiffSTG/output/model/', 'PATH_LOG': '/content/drive/MyDrive/DiffSTG/output/log/', 'PATH_FORECAST': '/content/drive/MyDrive/DiffSTG/output/forecast/', 'data': {'name': 'PM', 'path': '/content/drive/MyDrive/DiffSTG/data/dataset/', 'feature_file': '/content/drive/MyDrive/DiffSTG/data/dataset/PM/flow.npy', 'spatial': '/content/drive/MyDrive/DiffSTG/data/dataset/PM/adj.npy', 'num_recent': 1, 'num_features': 1, 'num_vertices': 22, 'points_per_hour': 1, 'val_start_idx': 837, 'test_start_idx': 1116}, 'gpu_id': None, 'model': {'T_p': 12, 'T_h': 12, 'V': 22, 'F': 1, 'week_len': 7, 'day_len': 24, 'device': device(type='cuda'), 'd_h': 32, 'N': 200, 'sample_steps': 200, 'epsilon_theta': 'UGnet', 'is_label_condition': True, 'beta_end': 0.1, 'beta_schedule': 'quad', 'sample_strategy': 'ddpm', 'channel_multipliers': [1, 2], 'supports_len': 2, 'C': 32, 'n_channels': 32}, 'n_samples': 8, 'model_name': 'DiffSTG', 'is_test': False, 'epoch': 300, 'optimizer': 'adam', 'lr': 0.002, 'batch_size': 32, 'wd': 1e-05, 'early_stop': 10, 'start_epoch': 0, 'device': device(type='cuda'), 'logger': <utils.common_utils.Logger object at 0x7c2e64ea2ed0>, 'nni': False, 'mask_ratio': 0.0, 'T_h': 12, 'T_p': 12, 'trial_name': 'UGnet+32+200+quad+0.1+200+ddpm+12+8+True+PM+0.0+False+False+0.002+32', 'log_path': '/content/drive/MyDrive/DiffSTG/output/log//UGnet+32+200+quad+0.1+200+ddpm+12+8+True+PM+0.0+False+False+0.002+32.log'}
model path:/content/drive/MyDrive/DiffSTG/output/model/UGnet+32+200+quad+0.1+200+ddpm+12+8+True+PM+0.0+False+False+0.002+32N-200+T_h-12+T_p-12+epsilon_theta-UGnet.dm4stg
forecast_path:/content/drive/MyDrive/DiffSTG/output/model/UGnet+32+200+quad+0.1+200+ddpm+12+8+True+PM+0.0+False+False+0.002+32N-200+T_h-12+T_p-12+epsilon_theta-UGnet.dm4stg
DiffSTG(
  (eps_model): UGnet(
    (down): ModuleList(
      (0-1): 2 x DownBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Identity()
          (t_conv): Conv2d(32, 32, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 32), eps=1e-05, elementwise_affine=True)
        )
      )
      (2): Downsample(
        (conv): Conv2d(32, 32, kernel_size=(1, 3), stride=(1, 2), padding=(0, 1))
      )
      (3): DownBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(32, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(32, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
            (shortcut): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
          (t_conv): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 64), eps=1e-05, elementwise_affine=True)
        )
      )
      (4): DownBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Identity()
          (t_conv): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 64), eps=1e-05, elementwise_affine=True)
        )
      )
    )
    (middle): MiddleBlock(
      (res1): ResidualBlock(
        (tcn1): TcnBlock(
          (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
          (chomp): Chomp()
          (drop): Dropout(p=0.0, inplace=False)
          (net): Sequential(
            (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (1): Chomp()
            (2): Dropout(p=0.0, inplace=False)
          )
        )
        (tcn2): TcnBlock(
          (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
          (chomp): Chomp()
          (drop): Dropout(p=0.0, inplace=False)
          (net): Sequential(
            (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (1): Chomp()
            (2): Dropout(p=0.0, inplace=False)
          )
        )
        (shortcut): Identity()
        (t_conv): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
        (spatial): SpatialBlock()
        (norm): LayerNorm((22, 64), eps=1e-05, elementwise_affine=True)
      )
      (res2): ResidualBlock(
        (tcn1): TcnBlock(
          (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
          (chomp): Chomp()
          (drop): Dropout(p=0.0, inplace=False)
          (net): Sequential(
            (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (1): Chomp()
            (2): Dropout(p=0.0, inplace=False)
          )
        )
        (tcn2): TcnBlock(
          (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
          (chomp): Chomp()
          (drop): Dropout(p=0.0, inplace=False)
          (net): Sequential(
            (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (1): Chomp()
            (2): Dropout(p=0.0, inplace=False)
          )
        )
        (shortcut): Identity()
        (t_conv): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
        (spatial): SpatialBlock()
        (norm): LayerNorm((22, 64), eps=1e-05, elementwise_affine=True)
      )
    )
    (up): ModuleList(
      (0-1): 2 x UpBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(128, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(128, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
            (shortcut): Conv2d(128, 64, kernel_size=(1, 1), stride=(1, 1))
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Conv2d(128, 64, kernel_size=(1, 1), stride=(1, 1))
          (t_conv): Conv2d(32, 64, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 64), eps=1e-05, elementwise_affine=True)
        )
      )
      (2): UpBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(96, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(96, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
            (shortcut): Conv2d(96, 32, kernel_size=(1, 1), stride=(1, 1))
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Conv2d(96, 32, kernel_size=(1, 1), stride=(1, 1))
          (t_conv): Conv2d(32, 32, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 32), eps=1e-05, elementwise_affine=True)
        )
      )
      (3): Upsample(
        (conv): ConvTranspose2d(32, 32, kernel_size=(1, 4), stride=(1, 2), padding=(0, 1))
      )
      (4-6): 3 x UpBlock(
        (res): ResidualBlock(
          (tcn1): TcnBlock(
            (conv): Conv2d(64, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(64, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
            (shortcut): Conv2d(64, 32, kernel_size=(1, 1), stride=(1, 1))
          )
          (tcn2): TcnBlock(
            (conv): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
            (chomp): Chomp()
            (drop): Dropout(p=0.0, inplace=False)
            (net): Sequential(
              (0): Conv2d(32, 32, kernel_size=(3, 3), stride=(1, 1), padding=(1, 2))
              (1): Chomp()
              (2): Dropout(p=0.0, inplace=False)
            )
          )
          (shortcut): Conv2d(64, 32, kernel_size=(1, 1), stride=(1, 1))
          (t_conv): Conv2d(32, 32, kernel_size=(1, 1), stride=(1, 1))
          (spatial): SpatialBlock()
          (norm): LayerNorm((22, 32), eps=1e-05, elementwise_affine=True)
        )
      )
    )
    (x_proj): Conv2d(1, 32, kernel_size=(1, 1), stride=(1, 1))
    (out): Sequential(
      (0): Conv2d(32, 1, kernel_size=(1, 1), stride=(1, 1))
      (1): Linear(in_features=48, out_features=24, bias=True)
    )
  )
)Num_of_parameters:826297
      |---Train--- |---Val Future-- -|-----Val History----|
Epoch | Loss  Time | MAE     RMSE    |  MAE    RMSE   Time|
   1.0| 10.560 3.4s |[411.49 648.35 ] | 402.11 636.90 33.08s
   2.0| 9.871 1.8s | 423.51 675.88  | 425.33 682.23 34.13s
   3.0| 9.336 1.8s | 414.07 675.68  | 409.04 663.19 34.60s
   4.0| 7.457 1.8s |[256.23 408.24 ] | 231.32 353.88 34.21s
   5.0| 4.577 1.8s |[86.20  119.23 ] | 68.77  88.72  34.53s
   6.0| 2.784 1.8s |[31.31  40.47  ] | 20.73  27.60  34.32s
   7.0| 2.090 1.8s |[29.13  37.78  ] | 22.23  28.73  34.41s
   8.0| 1.813 1.8s |[22.65  29.82  ] | 18.43  24.06  34.36s
   9.0| 1.687 1.9s |[18.98  25.24  ] | 13.87  19.09  34.36s
  10.0| 1.562 1.9s |[15.81  21.36  ] | 9.85   13.81  34.35s
  11.0| 1.476 1.9s | 18.10  23.80   | 15.77  20.55  34.35s
  12.0| 1.419 1.9s |[15.73  21.18  ] | 15.17  19.88  34.40s
  13.0| 1.363 1.9s | 16.22  21.50   | 8.92   12.39  34.38s
  14.0| 1.313 1.9s |[13.18  18.15  ] | 6.05   8.03   34.40s
  15.0| 1.291 1.9s | 15.50  21.26   | 5.01   6.93   34.38s
  16.0| 1.278 1.9s | 13.76  18.92   | 5.16   7.02   34.37s
  17.0| 1.234 1.9s | 17.82  23.55   | 10.77  14.70  34.34s
  18.0| 1.178 1.9s | 15.83  21.35   | 3.79   5.37   34.38s
  19.0| 1.146 1.8s | 19.68  25.87   | 4.87   6.97   34.34s
  20.0| 1.109 1.9s | 19.05  24.60   | 5.90   8.23   34.40s
  21.0| 1.043 1.9s |[12.44  17.17  ] | 5.45   7.10   34.35s
  22.0| 0.999 1.9s | 12.53  17.14   | 5.43   7.01   34.34s
  23.0| 0.966 1.9s |[12.37  16.92  ] | 2.89   3.95   34.35s
  24.0| 0.959 1.9s |[12.07  16.44  ] | 3.38   4.51   34.38s
  25.0| 0.951 1.8s | 12.36  16.89   | 4.39   5.73   34.37s
  26.0| 0.917 1.8s | 13.88  18.53   | 4.24   5.56   34.42s
  27.0| 0.891 1.9s | 14.65  19.59   | 2.51   3.41   34.31s
  28.0| 0.878 1.8s | 15.74  20.81   | 2.66   3.66   34.37s
  29.0| 0.854 1.9s | 14.93  20.03   | 3.08   4.18   34.43s
  30.0| 0.854 1.9s | 12.57  17.56   | 2.41   3.33   34.38s
  31.0| 0.797 1.8s |[11.13  15.71  ] | 1.88   2.63   34.33s
  32.0| 0.777 1.8s |[10.77  15.35  ] | 1.77   2.49   34.36s
  33.0| 0.754 1.9s |[10.76  15.32  ] | 1.72   2.43   34.39s
  34.0| 0.736 1.9s | 11.04  15.58   | 1.76   2.46   34.37s
  35.0| 0.721 1.8s | 11.08  15.58   | 2.04   2.80   34.36s
  36.0| 0.710 1.8s |[10.67  15.16  ] | 2.16   2.96   34.37s
  37.0| 0.695 1.8s | 10.68  15.41   | 1.92   2.67   34.33s
  38.0| 0.679 1.8s |[10.27  14.78  ] | 1.83   2.55   34.36s
  39.0| 0.667 1.9s | 10.77  15.15   | 1.74   2.41   34.31s
  40.0| 0.663 1.8s | 11.00  15.35   | 1.74   2.39   34.34s
  41.0| 0.661 1.8s | 10.85  15.17   | 1.93   2.62   34.31s
  42.0| 0.663 1.8s | 10.38  14.70   | 1.88   2.61   34.33s
  43.0| 0.644 1.8s |[10.10  14.56  ] | 1.61   2.28   34.37s
  44.0| 0.620 1.8s | 10.39  14.94   | 1.58   2.18   34.30s
  45.0| 0.611 1.8s | 10.45  14.72   | 1.70   2.32   34.34s
  46.0| 0.596 1.8s | 11.35  15.78   | 1.85   2.48   34.31s
  47.0| 0.599 1.8s | 10.50  14.95   | 1.81   2.49   34.35s
  48.0| 0.574 1.8s | 10.39  14.81   | 1.71   2.38   34.37s
  49.0| 0.559 1.8s | 10.20  14.68   | 1.61   2.27   34.32s
  50.0| 0.544 1.8s | 13.22  18.17   | 1.54   2.13   34.39s
  51.0| 0.549 1.9s | 12.58  17.41   | 1.71   2.35   34.41s
  52.0| 0.525 1.8s | 12.25  16.87   | 1.72   2.35   34.38s
  53.0| 0.510 1.8s | 12.66  17.37   | 1.74   2.36   34.31s
  54.0| 0.495 1.8s | 12.18  16.81   | 1.75   2.36   34.32s
predict_path = '/content/drive/MyDrive/DiffSTG/output/forecast/UGnet+32+200+quad+0.1+200+ddpm+12+8+True+PM+0.0+False+False+0.002+32.pkl'
 |[9.76   13.15  ] | 1.29   1.68   56.28s
sample_strategy:ddim_multi, sample_steps:40 Final results in test:9.76   13.15  10.77  0.08    153.73  | 54   
